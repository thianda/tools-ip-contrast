## IP 备案信息对比思路

### 存储格式

**省内资管**：IP 可拆分为`/32`，也可成段的如`/24`。未启用则未录入到资管。导出数据均为已启用。

**集团**：每个 IP 一行，无掩码。不区分是否启用，每个 C 类 IP 地址保存为 256 行。导出数据为全量数据。

**工信部**：默认为成段的 IP 段，使用后做最小化的地址拆分。保存时分为起始 IP 和终止 IP 俩列。导出数据为全量数据。

### 对比规则

基于 IP 地址，对比 6 个字段是否一致。字段名称如下表。

| 序号 | 省内资管              | 集团                  | 工信部         |
| ---- | --------------------- | --------------------- | -------------- |
| 1    | IP地址                | 网段名称              | 起始IP;终止IP  |
| 2    | 联系人姓名(客户侧)    | 联系人姓名(客户侧)    | 联系人姓名     |
| 3    | 联系电话(客户侧)      | 联系人电话(客户侧)    | 联系人电话     |
| 4    | 分配使用时间          | 分配使用时间          | 分配日期       |
| 5    | 单位详细地址          | 单位详细地址          | 单位详细地址   |
| 6    | 联系人邮箱(客户侧)    | 联系人邮箱(客户侧)    | 联系人电子邮件 |
| 7    | 单位名称/具体业务信息 | 单位名称/具体业务信息 | 使用单位名称   |

新启用 IP 地址后，在省内资管中体现为新增数据。集团中体现为将未启用修改为已使用。在工信部中体现为将自用修改为已启用。

### 数据处理

由于涉及 IP 地址的合并与拆分，对比之前需要对数据进行相应的处理。

首先将 IP 地址转换为起始 IP 与结束 IP 俩列（用十进制表示，便于排序），即使用 IP 范围表示一条信息。（起始 IP 和结束 IP 可相等）

### 对比结果说明

`TRUE`为一致。

`FALSE`为不一致。

对比结果中会出现`#N/A`，原因：

1. 省内资管存在、其他系统中不存在
   - 在其他系统的确不存在备案信息
   - 存在但是被小程序过滤掉了（详见过滤数据部分）
2. 工信部中为合并地址段，省内资管为拆分地址，故无法匹配。（需手动判断）

### 过滤数据提高效率

集团中、工信部中的数据为全量数据，可先过滤未启用的数据。经测试过滤后小工具运行时间平均缩短为原来的 25%。

规则：单位详细地址 为空

基于此规则，测试了铁岭市的导出数据以及全省全专业的导出数据。

在铁岭市的**集团**中可能误过滤的数据：

```ini
城域网网络地址
WLAN网络地址
家客用户地址池
金牌集客
集客专线
集客地址
集客用户地址池
业务系统
...
```

全量数据中

```ini
## gprs
大连周水子机房GI防火墙互联地址
GPRS/LTE Sgi NAT地址
GPRS/LTE Gn地址
大连甘井子机房GI防火墙互联地址
辽宁移动网管中心数据性能室
GI地址
分组域核心网GI NAT地址
网管中心
大连GPRS新建GI口（包括2G、3G）
大连风景街GPRS E8000-1 LOOPBACK地址
大连风景街GPRS E8000-2 LOOPBACK地址
GPRS
小基站网关项目-大连
Gn地址
互联网拨测系统
大连甘井子机房SAEGW-PCRF 20151207

## idc
IDC地址
沈北IDC
道义IDC

## jiake
用户地址池
盘锦移动公司/家客地址池
家客用户地址池
家客
其他
中国移动营口分公司
家客地址池
...

## jike
互联网专线
集客专线
互联网专线地址
集客业务

## qita
（特别多）

## wangluoshebei
（特别多）

## wlan
WLAN公网地址池
WLAN地址池
WALN地址池
WLAN用户地址池

## ziyouyewu
（特别多）
```

针对集团中的 单位详细地址 为空的数据：

1. 若不过滤，匹配结果必定为不一致（省内资管中单位详细地址不为空，工信部为自用）
2. 若过滤，显示结果为 `#N/A`，需进一步手动判断。但小工具运行效率时间有明细缩短。

而**工信部**中过滤的都是未启用（未备案）的。缩短效率时间的同时对结果暂无影响。

